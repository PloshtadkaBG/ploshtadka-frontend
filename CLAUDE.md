# CLAUDE.md — ploshtadka-frontend

React SSR-capable app (TanStack Start) serving the public-facing venue booking experience (part of PloshtadkaBG).

## Running

```bash
bun run dev      # Vite dev server on port 3000
bun run build    # production build
bun run test     # vitest (unit/component tests)
```

## Architecture

### Tech stack

- **Router**: TanStack Router v1 with TanStack Start (SSR) — file-based routing
- **Data fetching**: TanStack Query v5
- **Forms**: TanStack Form v1
- **Styling**: Tailwind 4 + shadcn/ui + framer-motion
- **i18n**: intlayer — locale prefix injected via `{-$locale}` route segment
- **Runtime**: Vite + bun
- **Tests**: vitest + @testing-library/react

### Project structure

```
src/
  routes/
    __root.tsx            # Root layout: IntlayerProvider, QueryClientProvider, Header
    {-$locale}/           # Optional locale prefix segment (e.g. /en, /bg, or none)
      route.tsx           # Validates locale; notFoundComponent for child 404s
      index.tsx           # Landing page
      auth/
        login.tsx
        signup.tsx
      404.tsx
      $.tsx               # Catch-all
  routeTree.gen.ts        # AUTO-GENERATED by TanStack Router — do not edit manually
  features/
    Auth/
      api/
        api-client.ts     # axios instance → http://localhost:8022
        hooks.ts          # useLogin, useLogout, useMe, etc.
        types.ts
      components/         # LoginForm, SignupForm, FormWrapper
      contents/           # intlayer content declarations
      schemas/            # Zod schemas for form validation
  components/
    pages/                # landing, not-found
    templates/            # header
    ui/                   # shadcn/ui + custom components
  contents/               # root-level intlayer content declarations
  hooks/
    useLocalizedNavigate.ts
  constants.ts            # shared QueryClient instance
  styles.css
```

### Routing

TanStack Start uses file-based routing. The route tree is **auto-generated** into `src/routeTree.gen.ts` by `@tanstack/router-plugin` at build time — never edit it directly.

The `{-$locale}` segment is an optional dynamic prefix that captures the locale (`en`, `bg`, etc.). `route.tsx` validates the prefix and redirects invalid locales to `/404`.

To add a new route, create a file under `src/routes/{-$locale}/` following the file-naming convention.

### i18n (intlayer)

Content declarations (`*.content.ts`) live next to the components they belong to and are imported via the `intlayer` package. The locale is extracted from route params and passed to `IntlayerProvider` in `__root.tsx`. Use `useIntlayer(key)` in components or `getIntlayer(key, locale)` in route loaders.

### API client

`src/features/Auth/api/api-client.ts` — axios instance with base URL `http://localhost:8022`. Attaches `Authorization: Bearer <token>` from localStorage.

Note: the frontend API client hits port 8022 (presumably a local dev proxy), unlike the admin panel which hits port 80 (Traefik directly).

### Auth flow (frontend side)

Mirrors the admin panel:
1. `POST /auth/token` (form-urlencoded) → stores `access_token` in `localStorage`
2. `GET /users/@me/get` with `staleTime: Infinity` for current user
3. Logout: removes token + clears QueryClient cache

### Testing

Tests use vitest + `@testing-library/react`. Run with `bun run test` (vitest in run mode).
